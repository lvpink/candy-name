<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>琉璃孤独棋 - 增强版</title>
    <style type="text/css">
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #e0e0e0;
            background-image: radial-gradient(circle, #f0f0f0 0%, #d1d1d1 100%);
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            display: flex; justify-content: center; align-items: center;
            user-select: none; -webkit-user-select: none;
        }

        /* 水印层：淡淡的标识 */
        .watermark {
            position: absolute; bottom: 10px; right: 20px;
            font-size: 12px; color: rgba(0,0,0,0.1);
            pointer-events: none; z-index: 1;
        }

        /* 弹窗样式 */
        #modalOverlay {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .rules-modal {
            background: rgba(255, 255, 255, 0.95); width: 85%; max-width: 380px;
            border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            overflow: hidden; animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.2);
        }
        .modal-header-img {
            width: 100%; height: 160px;
            background: linear-gradient(rgba(93, 64, 55, 0.3), rgba(93, 64, 55, 0.1)),
                        url('https://www.transparenttextures.com/patterns/wood-pattern-7.png'), #d2a679;
            display: flex; justify-content: center; align-items: center; border-bottom: 3px solid #b3865c;
        }
        .modal-header-img::after {
            content: ""; width: 85%; height: 85%;
            background: url('http://picnew11.photophoto.cn/20170315/napolun-22544446_1.jpg') no-repeat center;
            background-size: contain; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2));
        }

        /* 游戏区域 */
        .game-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; height: 100%; padding: 10px; box-sizing: border-box; }
        .controls-top { display: flex; align-items: center; gap: 15px; margin: 15px 0; z-index: 10; }
        #scoreText { margin: 0; padding: 8px 20px; font-size: 1.2em; font-weight: bold; color: #5d4037; background: rgba(255, 255, 255, 0.5); border-radius: 12px; }
        .confirm-btn { display: block; width: 100%; background: #8d6e63; color: white; border: none; padding: 12px; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 15px; }

        /* 棋盘与棋子自适应 */
        #gameBoard {
            background: #d2a679 url('https://www.transparenttextures.com/patterns/wood-pattern-7.png');
            border-spacing: min(1.5vw, 12px); padding: min(4vw, 35px); border-radius: 50%;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25), inset 0 -8px 15px rgba(0,0,0,0.2);
            border: min(2.5vw, 15px) solid #b3865c; max-width: 95vmin; max-height: 75vh;
            position: relative;
        }
        .allNum {
            width: clamp(35px, 8.5vmin, 72px); height: clamp(35px, 8.5vmin, 72px);
            border-radius: 50%; cursor: pointer; position: relative; background: #5d4037;
            box-shadow: inset 4px 6px 15px rgba(0,0,0,0.4);
        }
        .allNum::before {
            content: ""; display: block; width: 100%; height: 100%; border-radius: 50%; opacity: 0;
            box-shadow: inset 0 -15px 25px rgba(255,255,255,0.35), inset 0 10px 20px rgba(0,0,0,0.2), 0 8px 15px rgba(0,0,0,0.3);
            transition: all 0.25s cubic-bezier(0.1, 0.7, 0.1, 1);
        }
        .allNum::after {
            content: ""; position: absolute; top: 18%; left: 25%; width: 15%; height: 10%;
            background: rgba(255, 255, 255, 0.7); border-radius: 50%; transform: rotate(-25deg); filter: blur(1px); opacity: 0;
        }
        .has-piece::before, .has-piece::after { opacity: 1; }
        .selected::before { transform: scale(1.15) translateY(-6px); filter: brightness(1.2); }
        .allNum[data-color="1"]::before { background: radial-gradient(circle at 40% 40%, #ff4d6d, #c9184a); }
        .allNum[data-color="2"]::before { background: radial-gradient(circle at 40% 40%, #00b4d8, #0077b6); }
        .allNum[data-color="3"]::before { background: radial-gradient(circle at 40% 40%, #70e000, #38b000); }
        .allNum[data-color="4"]::before { background: radial-gradient(circle at 40% 40%, #ffb703, #fb8500); }
        .allNum[data-color="5"]::before { background: radial-gradient(circle at 40% 40%, #bdb2ff, #9381ff); }

        /* 特效与动画 */
        .dust-cloud { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; background: rgba(210, 166, 121, 0.6); border-radius: 50%; transform: translate(-50%, -50%); animation: dust-pop 0.5s ease-out forwards; }
        @keyframes dust-pop { 0% { transform: translate(-50%, -10%) scale(0.3); opacity: 0; } 100% { transform: translate(-50%, -150%) scale(4); opacity: 0; filter: blur(10px); } }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.85); } to { opacity: 1; transform: scale(1); } }
        .zero { width: clamp(35px, 8.5vmin, 72px); height: clamp(35px, 8.5vmin, 72px); }
    </style>
</head>
<body oncontextmenu="return false" ondragstart="return false">

<div class="watermark">琉璃孤独棋 @ Original Design</div>

<div id="modalOverlay">
    <div class="rules-modal">
        <div class="modal-header-img"></div>
        <div class="modal-content" style="padding: 25px;">
            <h2 style="text-align:center; margin-top:0; color:#5d4037;">琉璃孤独棋</h2>
            <ul style="line-height: 1.8; color: #5d4037; font-size: 0.95em; padding-left: 20px;">
                <li>移除第一颗珠子开始。</li>
                <li>跳过珠子落入空位即消除。</li>
                <li>最终剩一颗即为挑战成功！</li>
            </ul>
            <button class="confirm-btn" onclick="closeModal()">进入挑战</button>
        </div>
    </div>
</div>

<div class="game-wrapper">
    <div class="controls-top">
        <p id="scoreText">剩余棋子：37</p>
        <button class="confirm-btn" style="margin:0; padding:8px 15px; width:auto; font-size: 0.9em;" onclick="resetGame()">重新打乱</button>
    </div>
    <table id="gameBoard"></table>
</div>

<script>
    /* --- 防抄袭脚本第一层：屏蔽键盘快捷键 --- */
    document.onkeydown = function(e) {
        if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74))) {
            return false;
        }
    };

 
    setInterval(function() {
        (function(_0xabc) {
            return (function(_0xdef) {
                return (function(_0xghi) {
                    if (!!_0xghi) return;
                    debugger;
                })(true);
            })(false);
        })();
    }, 2000);

    /* --- 核心游戏逻辑 --- */
    let isFirstRemoval = true;
    let selected = null;
    const boardLayout = [
        [null, null, [2,7], [3,7], [4,7], null, null],
        [null, [1,6], [2,6], [3,6], [4,6], [5,6], null],
        [[0,5], [1,5], [2,5], [3,5], [4,5], [5,5], [6,5]],
        [[0,4], [1,4], [2,4], [3,4], [4,4], [5,4], [6,4]],
        [[0,3], [1,3], [2,3], [3,3], [4,3], [5,3], [6,3]],
        [null, [1,2], [2,2], [3,2], [4,2], [5,2], null],
        [null, null, [2,1], [3,1], [4,1], null, null]
    ];

    function initBoard() {
        let html = "";
        boardLayout.forEach(row => {
            html += "<tr>";
            row.forEach(cell => {
                if (cell) {
                    const color = Math.floor(Math.random() * 5) + 1;
                    html += `<td class="allNum has-piece" data-x="${cell[0]}" data-y="${cell[1]}" data-color="${color}"></td>`;
                } else {
                    html += `<td class="zero"></td>`;
                }
            });
            html += "</tr>";
        });
        document.getElementById('gameBoard').innerHTML = html;
        isFirstRemoval = true;
        selected = null;
        updateUI();
    }

    function resetGame() { initBoard(); }
    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
    function updateUI() {
        const count = document.querySelectorAll('.has-piece').length;
        document.getElementById('scoreText').innerText = `剩余棋子：${count}`;
    }
    function triggerDust(el) {
        const dust = document.createElement('div');
        dust.className = 'dust-cloud';
        el.appendChild(dust);
        setTimeout(() => dust.remove(), 500);
    }

    document.getElementById('gameBoard').addEventListener('click', (e) => {
        const cell = e.target.closest('.allNum');
        if (!cell) return;

        if (isFirstRemoval) {
            cell.classList.remove('has-piece');
            triggerDust(cell);
            isFirstRemoval = false;
            updateUI();
            return;
        }

        if (cell.classList.contains('has-piece')) {
            if (selected) selected.classList.remove('selected');
            selected = cell;
            cell.classList.add('selected');
        } else if (selected) {
            const _x1 = +selected.dataset.x, _y1 = +selected.dataset.y;
            const _x2 = +cell.dataset.x, _y2 = +cell.dataset.y;
            const isV = (Math.abs(_x1 - _x2) === 2 && _y1 === _y2);
            const isH = (Math.abs(_y1 - _y2) === 2 && _x1 === _x2);

            if (isV || isH) {
                const mid = document.querySelector(`[data-x="${(_x1+_x2)/2}"][data-y="${(_y1+_y2)/2}"]`);
                if (mid && mid.classList.contains('has-piece')) {
                    cell.dataset.color = selected.dataset.color;
                    selected.classList.remove('has-piece', 'selected');
                    mid.classList.remove('has-piece');
                    cell.classList.add('has-piece');
                    triggerDust(mid);
                    selected = null;
                    updateUI();
                    if(document.querySelectorAll('.has-piece').length === 1) alert('天才！');
                }
            }
        }
    });

    window.onload = initBoard;
</script>
</body>
</html>
