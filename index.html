<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>琉璃孤独棋 - 最终完美适配版</title>
    <style type="text/css">
        /* 基础样式复位 */
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #e0e0e0;
            background-image: radial-gradient(circle, #f0f0f0 0%, #d1d1d1 100%);
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            user-select: none; -webkit-user-select: none;
        }

        /* --- 弹窗样式优化：高度增加，图片展示完整 --- */
        #modalOverlay {
            position: fixed; inset: 0; background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px); display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .rules-modal {
            background: rgba(255, 255, 255, 0.98); width: 88%; max-width: 420px;
            border-radius: 30px; box-shadow: 0 25px 70px rgba(0,0,0,0.5);
            overflow: hidden; animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.2);
        }
        .modal-header-img {
            width: 100%; height: 240px; /* 增加高度以完整容纳拿破仑 */
            background: #d2a679 url('https://www.transparenttextures.com/patterns/wood-pattern-7.png');
            display: flex; justify-content: center; align-items: center; border-bottom: 4px solid #b3865c;
            position: relative;
        }
        .modal-header-img::after {
            content: ""; width: 92%; height: 92%;
            background: url('http://picnew11.photophoto.cn/20170315/napolun-22544446_1.jpg') no-repeat center;
            background-size: contain; /* 确保拿破仑图片完整展示 */
            filter: drop-shadow(0 8px 20px rgba(0,0,0,0.3));
        }

        /* 游戏主体容器：全平台自适应核心 */
        .game-wrapper {
            display: flex; flex-direction: column; align-items: center;
            width: 100%; height: 100%; justify-content: center; 
            padding: 20px; box-sizing: border-box; gap: 3vh;
        }

        .controls-top { display: flex; align-items: center; gap: 15px; z-index: 10; }
        #scoreText { 
            margin: 0; padding: 12px 28px; font-size: 1.2em; font-weight: bold; color: #5d4037; 
            background: rgba(255, 255, 255, 0.7); border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .confirm-btn { 
            background: #8d6e63; color: white; border: none; padding: 12px 22px; 
            border-radius: 15px; font-weight: bold; cursor: pointer; transition: 0.2s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        .confirm-btn:active { transform: scale(0.95); }

        /* --- 棋盘全端适配：手机撑满，电脑不显小 --- */
        #gameBoard {
            background: #d2a679 url('https://www.transparenttextures.com/patterns/wood-pattern-7.png');
            /* 使用 vmin 自动感应屏幕短边，确保两端都“刚好” */
            border-spacing: 1.3vmin; 
            padding: 2.5vmin; 
            border-radius: 50%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3), inset 0 -5px 15px rgba(0,0,0,0.2);
            border: 1.8vmin solid #b3865c;
            
            /* 关键逻辑：手机取屏幕90%左右，电脑最大锁在600px */
            width: clamp(320px, 90vmin, 600px);
            height: clamp(320px, 90vmin, 600px);
            table-layout: fixed;
        }

        /* 珠子质感适配 */
        .allNum {
            width: 11%; height: 11%; border-radius: 50%; cursor: pointer; position: relative;
            background: #5d4037; box-shadow: inset 2px 3px 8px rgba(0,0,0,0.4);
        }
        .allNum::before {
            content: ""; display: block; width: 100%; height: 100%; border-radius: 50%; opacity: 0;
            box-shadow: inset 0 -8px 15px rgba(255,255,255,0.3), inset 0 5px 10px rgba(0,0,0,0.2), 0 5px 10px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }
        .allNum::after {
            content: ""; position: absolute; top: 15%; left: 20%; width: 25%; height: 20%;
            background: rgba(255, 255, 255, 0.6); border-radius: 50%; filter: blur(1px); opacity: 0;
        }
        .has-piece::before, .has-piece::after { opacity: 1; }
        .selected::before { transform: scale(1.15); filter: brightness(1.35); box-shadow: 0 0 15px rgba(255,255,255,0.5); }
        
        /* 珠子颜色库 */
        .allNum[data-color="1"]::before { background: radial-gradient(circle at 35% 35%, #ff4d6d, #c9184a); }
        .allNum[data-color="2"]::before { background: radial-gradient(circle at 35% 35%, #00b4d8, #0077b6); }
        .allNum[data-color="3"]::before { background: radial-gradient(circle at 35% 35%, #70e000, #38b000); }
        .allNum[data-color="4"]::before { background: radial-gradient(circle at 35% 35%, #ffb703, #fb8500); }
        .allNum[data-color="5"]::before { background: radial-gradient(circle at 35% 35%, #bdb2ff, #9381ff); }

        .zero { width: 11%; height: 11%; }

        /* 消除动画 */
        .dust-cloud { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; background: rgba(210,166,121,0.6); border-radius: 50%; transform: translate(-50%, -50%); animation: dust-pop 0.5s forwards; }
        @keyframes dust-pop { 0% { transform: translate(-50%, -10%) scale(0.3); opacity: 0; } 100% { transform: translate(-50%, -150%) scale(3); opacity: 0; filter: blur(5px); } }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        
        .watermark { position: absolute; bottom: 10px; font-size: 10px; color: rgba(0,0,0,0.15); pointer-events: none; }
    </style>
</head>
<body oncontextmenu="return false">

<div id="modalOverlay">
    <div class="rules-modal">
        <div class="modal-header-img"></div>
        <div class="modal-content" style="padding: 30px; text-align: center;">
            <h2 style="margin:0 0 15px 0; color:#5d4037; letter-spacing: 2px;">琉璃孤独棋</h2>
            <p style="color:#6d4c41; font-size:1em; line-height:1.7; text-align: left;">
                1. 点击移除任意一颗珠子开始游戏。<br>
                2. 跳过一颗珠子并落入空位即可消除它。<br>
                3. 努力消除，直到棋盘只剩最后一颗琉璃珠！
            </p>
            <button class="confirm-btn" style="width: 100%; margin-top: 20px; font-size: 1.1em;" onclick="closeModal()">开始挑战</button>
        </div>
    </div>
</div>

<div class="game-wrapper">
    <div class="controls-top">
        <p id="scoreText">剩余珠子：37</p>
        <button class="confirm-btn" onclick="resetGame()">重新洗牌</button>
    </div>
    
    <table id="gameBoard"></table>
</div>

<div class="watermark">Copyright © 琉璃工艺孤独棋 完美适配版</div>

<script>
    /* 核心逻辑与防抄袭 */
    document.onkeydown = e => { if (e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74))) return false; };
    setInterval(() => { (function(){ debugger; })(); }, 3000);

    let isFirst = true, selected = null;
    const layout = [
        [null, null, [2,7], [3,7], [4,7], null, null],
        [null, [1,6], [2,6], [3,6], [4,6], [5,6], null],
        [[0,5], [1,5], [2,5], [3,5], [4,5], [5,5], [6,5]],
        [[0,4], [1,4], [2,4], [3,4], [4,4], [5,4], [6,4]],
        [[0,3], [1,3], [2,3], [3,3], [4,3], [5,3], [6,3]],
        [null, [1,2], [2,2], [3,2], [4,2], [5,2], null],
        [null, null, [2,1], [3,1], [4,1], null, null]
    ];

    function initBoard() {
        let html = "";
        layout.forEach(row => {
            html += "<tr>";
            row.forEach(cell => {
                if (cell) {
                    const color = Math.floor(Math.random() * 5) + 1;
                    html += `<td class="allNum has-piece" data-x="${cell[0]}" data-y="${cell[1]}" data-color="${color}"></td>`;
                } else {
                    html += `<td class="zero"></td>`;
                }
            });
            html += "</tr>";
        });
        document.getElementById('gameBoard').innerHTML = html;
        isFirst = true; selected = null; updateUI();
    }

    function resetGame() { 
        if(confirm("确定要重新开始吗？")) initBoard(); 
    }
    
    function closeModal() { 
        document.getElementById('modalOverlay').style.transition = '0.3s';
        document.getElementById('modalOverlay').style.opacity = '0';
        setTimeout(() => { document.getElementById('modalOverlay').style.display = 'none'; }, 300);
    }

    function updateUI() { 
        document.getElementById('scoreText').innerText = `剩余珠子：${document.querySelectorAll('.has-piece').length}`; 
    }

    function triggerDust(el) {
        const d = document.createElement('div'); d.className = 'dust-cloud';
        el.appendChild(d); setTimeout(() => d.remove(), 500);
    }

    document.getElementById('gameBoard').addEventListener('click', e => {
        const cell = e.target.closest('.allNum');
        if (!cell) return;

        // 第一步：移除一颗开始
        if (isFirst) {
            cell.classList.remove('has-piece'); 
            triggerDust(cell);
            isFirst = false; updateUI(); return;
        }

        // 选中珠子逻辑
        if (cell.classList.contains('has-piece')) {
            if (selected) selected.classList.remove('selected');
            selected = cell; cell.classList.add('selected');
        } 
        // 移动逻辑
        else if (selected) {
            const x1 = +selected.dataset.x, y1 = +selected.dataset.y;
            const x2 = +cell.dataset.x, y2 = +cell.dataset.y;
            
            // 判断是否是跳过一格
            if ((Math.abs(x1-x2)===2 && y1===y2) || (Math.abs(y1-y2)===2 && x1===x2)) {
                const midX = (x1+x2)/2, midY = (y1+y2)/2;
                const mid = document.querySelector(`[data-x="${midX}"][data-y="${midY}"]`);
                
                if (mid && mid.classList.contains('has-piece')) {
                    cell.dataset.color = selected.dataset.color;
                    selected.classList.remove('has-piece', 'selected');
                    mid.classList.remove('has-piece'); 
                    cell.classList.add('has-piece');
                    triggerDust(mid); 
                    selected = null; 
                    updateUI();
                }
            }
        }
    });

    window.onload = initBoard;
</script>
</body>
</html>
