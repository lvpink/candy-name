<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>明亮糖果琉璃版 - 孤独棋</title>
    <style type="text/css">
        /* 保持你原有的 CSS 样式不变 */
        html, body {
            margin: 0; padding: 0; width: 100%; height: 100vh;
            overflow: hidden; 
            background: #e0e0e0;
            background-image: radial-gradient(circle, #f0f0f0 0%, #d1d1d1 100%);
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 禁止系统自带的选中文本 */
            user-select: none;
            -webkit-user-select: none;
        }

        #modalOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .rules-modal {
            background: rgba(255, 255, 255, 0.9);
            padding: 35px;
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            max-width: 400px;
            text-align: left;
            border: 1px solid white;
        }

        .confirm-btn {
            display: block; width: 100%; background: #8d6e63; color: white; border: none;
            padding: 12px; border-radius: 15px; font-weight: bold; cursor: pointer;
            margin-top: 20px; font-size: 1.1em;
        }

        .game-wrapper {
            position: relative;
            padding: 40px; 
            /* 智能缩放适配 */
            transform: scale(min(1, 0.9 * (100vh / 900px)));
            transform-origin: center center;
        }

        .controls-top-right {
            position: absolute;
            top: 40px;
            right: -120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            z-index: 100;
        }

        .btn-reset { 
            background: #8d6e63; color: white; border: none; padding: 12px 25px; 
            border-radius: 12px; cursor: pointer; font-weight: bold;
            box-shadow: 0 4px 0 #6d4c41; transition: 0.2s; font-size: 1em;
        }
        .btn-reset:active { transform: translateY(3px); box-shadow: none; }

        #scoreText { 
            margin: 0; padding: 10px 20px; font-size: 1.3em; font-weight: bold; color: #5d4037;
            background: rgba(255, 255, 255, 0.4); border-radius: 10px; border: 1px solid rgba(141, 110, 99, 0.2);
            text-shadow: 0 1px 2px rgba(255,255,255,0.8); white-space: nowrap; text-align: center;
        }

        #gameBoard {
            background: #d2a679 url('https://www.transparenttextures.com/patterns/wood-pattern-7.png');
            border-spacing: 12px; padding: 40px; border-radius: 50%; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.25), inset 0 -8px 15px rgba(0,0,0,0.2), inset 0 8px 20px rgba(255,255,255,0.4);
            border: 15px solid #b3865c;
        }

        .allNum {
            width: 72px; height: 72px; border-radius: 50%; cursor: pointer; position: relative;
            background: #5d4037; box-shadow: inset 4px 6px 15px rgba(0,0,0,0.4);
        }

        .allNum::before {
            content: ""; display: block; width: 100%; height: 100%; border-radius: 50%; opacity: 0;
            box-shadow: inset 0 -15px 25px rgba(255,255,255,0.35), inset 0 10px 20px rgba(0,0,0,0.2), 0 8px 15px rgba(0,0,0,0.3);
            transition: all 0.25s cubic-bezier(0.1, 0.7, 0.1, 1); z-index: 2;
        }

        .allNum::after {
            content: ""; position: absolute; top: 18%; left: 25%; width: 12px; height: 8px;
            background: rgba(255, 255, 255, 0.7); border-radius: 50%; transform: rotate(-25deg);
            filter: blur(1.5px); opacity: 0; pointer-events: none; z-index: 3;
        }

        .has-piece::before, .has-piece::after { opacity: 1; }

        .selected::before {
            transform: scale(1.15) translateY(-8px); filter: brightness(1.2) saturate(1.2);
            box-shadow: inset 0 -15px 30px rgba(255,255,255,0.5), 0 20px 30px rgba(0,0,0,0.3);
        }
        
        .allNum[data-color="1"]::before { background: radial-gradient(circle at 40% 40%, #ff4d6d, #c9184a); }
        .allNum[data-color="2"]::before { background: radial-gradient(circle at 40% 40%, #00b4d8, #0077b6); }
        .allNum[data-color="3"]::before { background: radial-gradient(circle at 40% 40%, #70e000, #38b000); }
        .allNum[data-color="4"]::before { background: radial-gradient(circle at 40% 40%, #ffb703, #fb8500); }
        .allNum[data-color="5"]::before { background: radial-gradient(circle at 40% 40%, #bdb2ff, #9381ff); }

        .dust-cloud {
            position: absolute; top: 50%; left: 50%; width: 20px; height: 20px;
            background: rgba(210, 166, 121, 0.6); border-radius: 50%;
            transform: translate(-50%, -50%); pointer-events: none; z-index: 10;
            animation: dust-pop 0.5s ease-out forwards;
        }
        @keyframes dust-pop {
            0% { transform: translate(-50%, -10%) scale(0.3); opacity: 0; }
            100% { transform: translate(-50%, -150%) scale(4); opacity: 0; filter: blur(10px); }
        }
        .zero { width: 72px; height: 72px; }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false" ondragstart="return false">

<div id="modalOverlay">
    <div class="rules-modal">
        <h2 style="text-align:center">琉璃孤独棋</h2>
        <ul style="line-height: 2; color: #5d4037;">
            <li>点击第一颗珠子将其移除开始。</li>
            <li>跳过一颗珠子落入空位进行消除。</li>
            <li>目标：棋盘最终只剩<b style="color:#c9184a">一颗</b>珠子。</li>
        </ul>
        <button class="confirm-btn" onclick="startGame()">开始挑战</button>
    </div>
</div>

<div class="game-wrapper">
    <div class="controls-top-right">
        <button class="btn-reset" onclick="location.reload()">重新打乱</button>
        <p id="scoreText">剩余棋子：37</p>
    </div>
    <table id="gameBoard"></table>
</div>

<script>
    /* 防调试脚本：如果打开 F12 会导致无限断点 */
    (function() {
        const _d = function() { debugger; };
        setInterval(_d, 5000);
    })();

    let isFirst = true;
    let selected = null;

    function startGame() {
        document.getElementById('modalOverlay').style.display = 'none';
        _vibrate(50); // 开始游戏震动反馈
    }

    // 震动反馈小函数
    function _vibrate(ms) {
        if (navigator.vibrate) navigator.vibrate(ms);
    }

    const rows = [
        [null, null, [2,7], [3,7], [4,7], null, null],
        [null, [1,6], [2,6], [3,6], [4,6], [5,6], null],
        [[0,5], [1,5], [2,5], [3,5], [4,5], [5,5], [6,5]],
        [[0,4], [1,4], [2,4], [3,4], [4,4], [5,4], [6,4]],
        [[0,3], [1,3], [2,3], [3,3], [4,3], [5,3], [6,3]],
        [null, [1,2], [2,2], [3,2], [4,2], [5,2], null],
        [null, null, [2,1], [3,1], [4,1], null, null]
    ];
    
    let html = "";
    rows.forEach(row => {
        html += "<tr>";
        row.forEach(cell => {
            if (cell) {
                html += `<td class="allNum has-piece" data-x="${cell[0]}" data-y="${cell[1]}" data-color="${Math.floor(Math.random()*5)+1}"></td>`;
            } else {
                html += `<td class="zero"></td>`;
            }
        });
        html += "</tr>";
    });
    document.getElementById('gameBoard').innerHTML = html;

    function triggerDust(el) {
        const dust = document.createElement('div');
        dust.className = 'dust-cloud';
        el.appendChild(dust);
        setTimeout(() => dust.remove(), 500);
    }

    document.getElementById('gameBoard').addEventListener('click', (e) => {
        const cell = e.target.closest('.allNum');
        if (!cell) return;

        if (isFirst) {
            cell.classList.remove('has-piece');
            triggerDust(cell);
            isFirst = false;
            _vibrate(30);
            updateUI();
            return;
        }

        if (cell.classList.contains('has-piece')) {
            if (selected) selected.classList.remove('selected');
            selected = cell;
            cell.classList.add('selected');
            _vibrate(10);
        } else if (selected) {
            // 对核心跳跃逻辑进行混淆保护
            const _0x1 = +selected.dataset.x, _0x2 = +selected.dataset.y;
            const _0x3 = +cell.dataset.x, _0x4 = +cell.dataset.y;
            
            const isV = (Math.abs(_0x1 - _0x3) === 2 && _0x2 === _0x4);
            const isH = (Math.abs(_0x2 - _0x4) === 2 && _0x1 === _0x3);

            if (isV || isH) {
                const mid = document.querySelector(`[data-x="${(_0x1+_0x3)/2}"][data-y="${(_0x2+_0x4)/2}"]`);
                if (mid && mid.classList.contains('has-piece')) {
                    cell.dataset.color = selected.dataset.color;
                    selected.classList.remove('has-piece', 'selected');
                    mid.classList.remove('has-piece');
                    cell.classList.add('has-piece');
                    triggerDust(mid);
                    _vibrate(40);
                    selected = null;
                    updateUI();
                }
            }
        }
    });

    function updateUI() {
        const count = document.querySelectorAll('.has-piece').length;
        document.getElementById('scoreText').innerText = `剩余棋子：${count}`;
        if(count === 1) {
            setTimeout(() => alert('太厉害了！你是天才吗？'), 300);
        }
    }
</script>
</body>
</html>